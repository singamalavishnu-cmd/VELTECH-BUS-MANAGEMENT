<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Supabase Connection</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background-color: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }
    </style>
</head>
<body>
    <h1>Supabase Connection Test</h1>
    <div id="status" class="status loading">Testing connection to Supabase...</div>
    
    <h2>Test Admin Login</h2>
    <div id="admin-test" class="status">Not tested yet</div>
    
    <div>
        <h3>Test Credentials:</h3>
        <p><strong>Username:</strong> admin</p>
        <p><strong>Password:</strong> admin</p>
    </div>

    <script>
        async function testConnection() {
            const statusEl = document.getElementById('status');
            const adminTestEl = document.getElementById('admin-test');
            
            try {
                // Test basic Supabase connection
                statusEl.className = 'status loading';
                statusEl.textContent = 'Connecting to Supabase...';
                
                // Basic connection test
                const { data, error } = await window.supabaseClient
                    .from('admin_credentials')
                    .select('*')
                    .limit(1);
                
                if (error) throw error;
                
                statusEl.className = 'status success';
                statusEl.textContent = '✅ Successfully connected to Supabase!';
                
                // Test admin login
                adminTestEl.className = 'status loading';
                adminTestEl.textContent = 'Testing admin login...';
                
                try {
                    const { data: adminData, error: adminError } = await window.supabaseClient
                        .from('admin_credentials')
                        .select('*')
                        .eq('username', 'admin')
                        .single();
                    
                    if (adminError) throw adminError;
                    
                    adminTestEl.className = 'status success';
                    adminTestEl.innerHTML = `
                        ✅ Admin account found!<br>
                        <strong>Username:</strong> ${adminData.username}<br>
                        <strong>Phone:</strong> ${adminData.phone || 'Not set'}
                    `;
                } catch (adminErr) {
                    adminTestEl.className = 'status error';
                    adminTestEl.textContent = `❌ Admin login test failed: ${adminErr.message}`;
                }
                
            } catch (err) {
                statusEl.className = 'status error';
                statusEl.innerHTML = `
                    ❌ Connection failed: ${err.message}<br><br>
                    <strong>Troubleshooting steps:</strong>
                    <ol>
                        <li>Check your internet connection</li>
                        <li>Verify Supabase URL and Anon Key in supabase-config.js</li>
                        <li>Ensure CORS is properly configured in your Supabase dashboard</li>
                        <li>Check if Supabase service is up at <a href="https://status.supabase.com/" target="_blank">status.supabase.com</a></li>
                    </ol>
                `;
                console.error('Connection error:', err);
            }
        }

        // Run the test when the page loads
        document.addEventListener('DOMContentLoaded', testConnection);
    </script>
</body>
</html>
